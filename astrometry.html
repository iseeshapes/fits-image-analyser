<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Astrometry.net Options</title>
        <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script-->
        <script src="js/lib/jquery.min.js"></script>
    </head>
    <body>
        <h1>Astromery.net Command Generator</h1>
        <div class="introduction">
            Fill in the desired parameters and click "Generate Command".  Cut and paste the command in to the console.
        </div>
        <table>
            <tr>
                <td><label for="overWright">Overwrite</label></td>
                <td><input type="checkbox" id="overWright" value="true" /></td>
                <td>Overwrites any existing solution files</td>
            </tr>
            <tr>
                <td><label for="noPlot">No Plot</label></td>
                <td><input type="checkbox" id="noPlot" value="true" /></td>
                <td>If selected creates solution files not images</td>
            </tr>
            <tr>
                <td><label for="ra">Right Ascension</label></td>
                <td><input type="text" id="ra" value="" /></td>
                <td>RA center of the search in "9.9" (degress), "99h99m99.9s", or "99 99 99.9" format</td>
            </tr>
            <tr>
                <td><label for="dec">Declination</label></td>
                <td><input type="text" id="dec" value="" /></td>
                <td>Dec center of the search in "+9.9" (degress), "+99d99m99.9s", or "+99 99 99.9" format</td>
            </tr>
            <tr>
                <td><label for="radius">Radius</label></td>
                <td><input type="text" id="radius" value="" /></td>
                <td>Search radius in degrees</td>
            </tr>
            <tr>
                <td>Scale Units</td>
                <td>
                    <select id="scaleUnits">
                        <option value="no value">None</option>
                        <option value="arcsecperpix">Arcsec Per Pix</option>
                        <option value="degwidth">Degrees Width</option>
                        <option value="arcminwidth">Arcminute Width</option>
                    </select>
                </td>
                <td>Units for image scale</td>
            </tr>
            <tr>
                <td><label for="scaleLow">Scale Low</label></td>
                <td><input type="text" id="scaleLow" value="" /></td>
                <td>Guess at lowest image scale</td>
            </tr>
            <tr>
                <td><label for="scaleHigh">Scale High</label></td>
                <td><input type="text" id="scaleHigh" value="" /></td>
                <td>Guess at highest image scale</td>
            </tr>
            <tr>
                <td><label for="downsample">Downsample</label></td>
                <td><input type="text" id="downsample" value="" /></td>
                <td>Multiple to reduce image by (good for large images)</td>
            </tr>
            <tr>
                <td><label for="dir">Directory</label></td>
                <td><input type="text" id="dir" value="" /></td>
                <td>Solution file directory relative to current</td>
            </tr>
            <tr>
                <td><label for="depth">Depth</label></td>
                <td><input type="text" id="depth" value="" /></td>
                <td>Limits the stars used in the solution (speeds up query)</td>
            </tr>
            <tr>
                <td><label for="resort">Resort</label></td>
                <td><input type="checkbox" id="resort" value="false" /></td>
                <td>Can't remember</td>
            </tr>
            <tr>
                <td><label for="noVerify">No Verify</label></td>
                <td><input type="checkbox" id="noVerify" value="false" /></td>
                <td>Can't remember</td>
            </tr>
            <tr>
                <td>Parity</td>
                <td>
                    <select id="parity">
                        <option value="no value">None</option>
                        <option value="pos">Positive</option>
                        <option value="neg">Negative</option>
                    </select>
                </td>
                <td>Can't remember</td>
            </tr>
            <tr>
                <td><label for="verbose">Verbose</label></td>
                <td><input type="checkbox" id="verbose" value="false" /></td>
                <td>More console output (good for debuging commands)</td>
            </tr>
            <tr>
                <td><label for="filename">Filename</label></td>
                <td><input type="text" id="filename" value="" /></td>
                <td>File to be plate solved</td>
            </tr>
        </table>
        <button type="button" id="loadButton">Generate Command</button>
        <br>
        <textarea id="command" rows="8" cols="120"></textarea>
        <script type="text/javascript">
            function checkboxValue (id) {
                if ($("#" + id).prop('checked')) {
                    return true;
                }
                return undefined;
            }

            function convertRightAscension (id) {
                let item = $("#" + id)
                let value = item.val().trim();
                if (value === "") {
                    return undefined;
                }
                let group = null;
                group = /(\d+)h\s?(\d+)m\s?(\d+(\.\d+)?)s/.exec(value); //ra wiki pattern
                if (group == null) {
                    group = /(\d+) (\d+) (\d+(\.\d+)?)/.exec(value); //ra wiki pattern
                }
                if (group != null) {
                    item.css("color", "#000000");
                    let hours = Number(group[1]);
                    let minutes = Number(group[2]);
                    let seconds = Number(group[3]);
                    return (hours + minutes / 60 + seconds / 3600) * 15;
                }
                if (group == null) {
                    group = /^[+-]?\d+(\.\d+)?$/.exec(value); // degrees pattern
                }
                if (group != null) {
                    item.css("color", "#000000");
                    return Number(group[0]);
                }
                //private static Pattern degreesPattern = Pattern.compile("\\d+(\\.\\d+)?");
                //private static Pattern decWikiPattern = Pattern.compile("([+-]?\\d+)° (\\d+)′ (\\d+(.\\d+)?)″");
                //private static Pattern decSexagesimalPattern = Pattern.compile("([+-]?\\d+)d (\\d+)m (\\d+(\\.\\d+)?)s");
                item.css("color", "#ff0000");
                return undefined;
            }

            function convertDeclination (id) {
                let item = $("#" + id)
                let value = item.val().trim();
                if (value === "") {
                    return undefined;
                }
                let group = null;
                group = /([+-]?\d+)d\s?(\d+)m\s?(\d+(\.\d+)?)s/.exec(value); //dec letter pattern
                if (group == null) {
                    group = /([+-]?\d+)˚\s?(\d+)'\s?(\d+(\.\d+)?)"/.exec(value); //dec wiki pattern
                }
                if (group == null) {
                    group = /(\d+) (\d+) (\d+(\.\d+)?)/.exec(value); //dec space pattern
                }
                if (group != null) {
                    item.css("color", "#000000");
                    let degrees = Number(group[1]);
                    let minutes = Number(group[2]);
                    let seconds = Number(group[3]);
                    return degrees + minutes / 60 + seconds / 3600;
                }
                if (group == null) {
                    group = /^[+-]?\d+(\.\d+)?$/.exec(value); // degrees pattern
                }
                if (group != null) {
                    item.css("color", "#000000");
                    return Number(group[0]);
                }
                //private static Pattern degreesPattern = Pattern.compile("\\d+(\\.\\d+)?");
                //private static Pattern decWikiPattern = Pattern.compile("([+-]?\\d+)° (\\d+)′ (\\d+(.\\d+)?)″");
                //private static Pattern decSexagesimalPattern = Pattern.compile("([+-]?\\d+)d (\\d+)m (\\d+(\\.\\d+)?)s");
                item.css("color", "#ff0000");
                return undefined;
            }

            $('#loadButton').click(() => {
                let argument = {
                    '--overwrite' : checkboxValue ("overWright"),
                    '--no-plot' : checkboxValue ("noPlot"),
                    '--ra' : convertRightAscension ("ra"),
                    '--dec' : convertDeclination("dec"),
                    '--radius' : $("#radius").val(),
                    '--scale-low' : $("#scaleLow").val(),
                    '--scale-high' : $("#scaleHigh").val(),
                    '--scale-units' : $("#scaleUnits").val(),
                    '--downsample' : $("#downsample").val(),
                    '--dir' : $("#dir").val(),
                    '--depth' : $("#depth").val(),
                    '--resort' : checkboxValue ("resort"),
                    '--no-verify' : checkboxValue ("noVerify"),
                    '--parity' : $("#parity").val(),
                    '--verbose' : checkboxValue ("verbose")
                }
                let filename = $("#filename").val();

                let command = "solve-field"
                for (let [key, value] of Object.entries(argument)) {
                    if (value === true) {
                        command += " " + key;
                    } else if (value !== undefined && value !== "" && value != "no value") {
                        command += " " + key + " " + value;
                    }
                }
                if (filename !== undefined) {
                    command += " " + filename;
                }

                $("#command").val(command);
            });
        </script>
    </body>
</html>
